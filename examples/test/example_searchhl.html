<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "DTD/xhtml1-strict.dtd">
<html>
  <head>
	  <title>jQuery plugin "SearchHighlight"</title>
	  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js" type="text/javascript"></script>
	  <script src="js/SearchHighlight.js" type="text/javascript"></script>
	  <script type="text/javascript">
	  
  	  var options = {};
      jQuery(function(){
        reset_highlight();
        jQuery("input:not(:text)").click(reset_highlight)
        .filter("[name=keys_enabled]").click(function(){
          var disable = !jQuery(this).is(":checked");
          jQuery("input[name=keys],input[name=keys_button]").each(function(){
            this.disabled = disable;
          });
        });
        jQuery("input:text").change(reset_highlight);
      });
      function reset_highlight() {
        var disable = !jQuery("input[name=keys_enabled]").is(":checked");
        jQuery("input[name=keys],input[name=keys_button]").each(function(){
          this.disabled = disable;
        });
        jQuery("span[class^=hilite]").each(function(){
          var hilite = jQuery(this);
          var txt_el = hilite[0].previousSibling;
          if(txt_el && txt_el.nodeType==3)
            txt_el.data += hilite.text();
          else {
            hilite.before(hilite.text());
            txt_el = hilite[0].previousSibling;
          }
          if(hilite[0].nextSibling && hilite[0].nextSibling.nodeType==3) {
            txt_el.data += hilite[0].nextSibling.data;
            $(hilite[0].nextSibling).remove();
          }
          hilite.remove();
        });
        jQuery("#code").text(build_options());
        jQuery(document).SearchHighlight(options);
        
      }
      function build_options() {
        var code = "\tjQuery(function(){\r\n\t\tvar options = {\r\n\t\t\t";

        options.debug_referrer = jQuery("input[name=referrer]").val();
        
        options.exact = jQuery("input[name=exact]:checked").val();
        code += 'exact:"'+options.exact+'"';
        options.style_name_suffix = jQuery("input[name=suffix]").is(":checked");
        if(!options.style_name_suffix)
          code += ',\r\n\t\t\tstyle_name_suffix:'+options.style_name_suffix;
        if(jQuery("input[name=Highlight]").is(":checked")) {
          options.highlight = ".highlightable";
          code += ',\r\n\t\t\thighlight:".highlightable"';
        } else {
          delete(options.highlight);
        }
        if(jQuery("input[name=NoHighlight]").is(":checked")) {
          options.nohighlight = ".not_highlightable";
          code += ',\r\n\t\t\thighlight:".not_highlightable"';
        } else {
          delete(options.nohighlight);
        }        
        if(jQuery("input[name=keys_enabled]").is(":checked")) {
          options.keys = jQuery("input[name=keys]").val();
          code += ',\r\n\t\t\tkeys:"'+options.keys+'"';
        } else {
          delete(options.keys);
        }
        
        code += "\r\n\t\t}\r\n\t\tjQuery(document).SearchHighlight(options);\r\n\t});";
        return code;
      }
    </script>
	  <style type="text/css">
      
      .hilite,.hilite1 {background-color: yellow}
	  .hilite2 {background-color: pink}
      .hilite3 {background-color: gray}
      .hilite4 {background-color: orange}
	  </style>
  </head>
  <body>
    <h1>jQuery plugin "SearchHighlight"</h1>
    <div><a href="/spip.php?article50">Back to the article</a></div>
    <div>
      <h2>Test referrer:</h2> 
      <input style="width:600px" name="referrer" type="text" value="http://www.google.com?q=vita%20piu%20selva" />
      <input type="button" value="Submit" />
      <h2>Options</h2>
      <ul>
        <li>
          <strong>exact</strong><br />
          <div>
            <input type="radio" id="exact_exact" name="exact" value="exact" checked="checked" />
            <label for="exact_exact">exact (highlights the word only if it exactly matches)</label>
          </div>
          <div>
            <input type="radio" id="exact_whole" name="exact" value="whole" />
            <label for="exact_exact">whole (highlights all the words even if there is a partial match)</label>
          </div>
          <div>
            <input type="radio" id="exact_partial" name="exact" value="partial" />
            <label for="exact_exact">partial (highlights only the part of the word that matches)</label>
          </div>
        </li>
        <li>
          <input type="checkbox" name="suffix" checked="checked" />
          <label for="suffix"><strong>style_name_suffix</strong> (add a different number at the end of the highlight class for each different word, useful to have different colors)</label>
        </li>
        <li>
          <input type="checkbox" name="Highlight" />        
          <label for="suffix"><strong>highlight = ".highlightable"</strong> (highlights only inside the blocks matching the selector or jQuery object passed, in this case the third paragraph)</label>
        </li>
        <li>
          <input type="checkbox" name="NoHighlight" />        
          <label for="suffix"><strong>nohighlight = ".not_highlightable"</strong> (does not highlight inside the blocks matching the selector or jQuery object passed, in this case the forth paragraph)</label>
        </li>
        <li>
          <input type="checkbox" name="keys_enabled" />        
          <label for="suffix"><strong>keys</strong> (disables the referrer analisys and explicitly sets the words to be searched and highlighted)</label>
          <input type="texte" name="keys" disabled="disabled" /><input name="keys_button" type="button" value="Submit" disabled="disabled" />        
        </li>
      </ul>
      <h2>Code</h2>
      <pre id="code">
        jQuery(function(){
          var options = {};
          jQuery(document).SearchHighlight(options);
        });
      </pre>
    </div>
    <h2>Text</h2>
    <pre>
    Nel mezzo del cammin di nostra vita
    mi ritrovai per una selva oscura,
    ché la diritta via era smarrita.
    </pre>
    <div class="highlightable">
    <strong>This paragraph is wrapped inside a block with a class highlightable to delimitate the area enabled for highlight.</strong>
    <pre>
    Ahi quanto a dir qual era è cosa dura
    esta selva selvaggia e aspra e forte
    che nel pensier rinova la paura!
    </pre>
    </div>
    
    <div class="not_highlightable">
    <strong>This paragraph is wrapped inside a block with a class not_highlightable to exclude it from the area enabled for highlight.</strong>
    <pre>
    Tant'è amara che poco è più morte;
    ma per trattar del ben ch'i' vi trovai,
    dirò de l'altre cose ch'i' v' ho scorte.
    </pre>
    </div>
    
    <pre>
    La Divina Commedia - Dante Alighieri
    </pre>
    
  </body>
</html>